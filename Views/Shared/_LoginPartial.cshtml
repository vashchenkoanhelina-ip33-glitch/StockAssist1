@using Microsoft.AspNetCore.Identity
@using StockAssist.Web.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    var isSignedIn = SignInManager.IsSignedIn(User);
    ApplicationUser? appUser = null;
    string displayName = string.Empty;
    var isAdmin = false;

    if (isSignedIn)
    {
        appUser = await UserManager.GetUserAsync(User);
        displayName = appUser?.Email ?? appUser?.UserName ?? "користувач";

        if (appUser != null)
        {
            isAdmin = await UserManager.IsInRoleAsync(appUser, "Admin");
        }
    }
}

@if (isSignedIn)
{
    <li class="nav-item">
        <span class="navbar-text text-light me-3">
            Привіт, @displayName!
        </span>
    </li>

    @if (isAdmin)
    {
        <li class="nav-item">
            <a class="nav-link text-warning fw-semibold"
               asp-controller="Admin"
               asp-action="Index">
                Адмін-панель
            </a>
        </li>
    }

    <li class="nav-item">
        <form asp-area="Identity"
              asp-page="/Account/Logout"
              asp-route-returnUrl="/"
              method="post"
              class="d-inline">
            <button type="submit"
                    class="btn btn-link nav-link text-light">
                Вийти
            </button>
        </form>
    </li>
}
else
{
    <li class="nav-item">
        <a class="nav-link text-light"
           asp-area="Identity"
           asp-page="/Account/Login">
            Увійти
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link text-light"
           asp-area="Identity"
           asp-page="/Account/Register">
            Реєстрація
        </a>
    </li>
}